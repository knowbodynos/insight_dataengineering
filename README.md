# Language and Externals

This code was written in **Python** with only the external module `sys` for reading in arguments from the commandline.

# My Approach

My approach was to create two separate modules:

1. [`drugs_io`]

    This module contains two functions:

    * `read_csv_to_drug_dict`: Read from csv to a dict of dicts given by {drug_name: {prescriber_name: total_cost}}.

    * `write_drug_table_to_file`: Write table (i.e. list of lists) given by [[drug_name, num_prescriber, total_cost], ...]
        to file, including appropriate header line. 

2. [`drugs_transform`]

    This module contains four functions:

    * `split_line`: Split a line by a given delimiter, accounting for the 
        fact that that line may contain a quoted string literal with the
        delimiter character that shouldn't be counted as a delimiter.

    * `cost_to_string`: If total_cost is an integer, convert to string with no decimal
        places. If it is a float, round to two decimal places (i.e. a dollar amount).

    * `drug_dict_to_table`: Reshape the dict of dicts into a list of lists by accumulating
        the number of unique prescribers of each drug, and the total cost
        of that drug from all prescribers.

    * `sort_drug_table`: Sort the list of lists by first the total cost of all prescriptions
        of each drug, and then if there is a tie, by the drug name.

Then, putting everything together, I read in the input data from a csv file using `read_csv_to_drug_dict` (which uses `split_line` to capture the correct fields), obtained a table of results using `drug_dict_to_table`, sorting it using `sort_drug_table`, and finally writing it to an output csv file using `write_drug_table_to_file` (which uses `cost_to_string` to convert cost to a dollar amount).

# Tests

1. [**test_1**] This was the test included with the insight_testsuite.

2. [**test_2**] This was a sample from the over 24 million pharmaceutical records provided at: https://drive.google.com/file/d/1fxtTLR_Z5fTO-Y91BnKOQd6J0VC9gPO3/view?usp=sharing, and includes a strange case in which the drug name contains a comma (i.e. the field delimiter). The output was generated by running the code once in standalone mode. Although this does not confirm whether the output is correct, it confirms that the code is still working as it did during that benchmark run.

# Repo directory structure

The directory structure for your repo should look like this:

    ├── README.md 
    ├── run.sh
    ├── src
    │   └── drugs_io.py
    │   └── drugs_transform.py
    │   └── pharmacy_counting.py
    ├── input
    │   └── itcont.txt
    ├── output
    |   └── top_cost_drug.txt
    ├── insight_testsuite
        └── run_tests.sh
        └── tests
            └── test_1
            |   ├── input
            |   │   └── itcont.txt
            |   |__ output
            |   │   └── top_cost_drug.txt
            ├── test_2
                ├── input
                │   └── itcont.txt
                |── output
                    └── top_cost_drug.txt